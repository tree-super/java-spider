<!DOCTYPE>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>持续注意力测试系统 | 档案查询</title>
    <meta name="description" content="健康测评系统">
    
    <meta name="renderer" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>
    <meta http-equiv="pragma" content="no-cache" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
	<th:block th:replace="common/res::res"></th:block>

</head>

<body style="height:100%;">
	<div class="r-min-width">
		<form id="tb">
			<div class="ui-gauge">
<!--				<div class="ui-help">帮助</div>-->
				<ol class="clear" id="screeningMore">
					<ol class="clear">
						<li class="col3">
							<em>手机号码&nbsp;</em>
							<input type="text" name="CPhoneNo" class="easyui-validatebox" data-options="" placeholder="完整号码或尾号" />
						</li>
						<li class="col3">
							<em>姓名&nbsp;</em>
							<input type="text" name="CChildNme" />
						</li>
						<li class="col3">
							<em>性别&nbsp;</em>
							<select id="CChildSex" name="CChildSex" class="easyui-combobox" data-options="editable:false,width:200,panelHeight:110">
								<option value="">全部</option>
								<option value="M">男</option>
								<option value="F">女</option>
							</select>
						</li>
					</ol>
					<!-- 折叠 -->
					<ol class="clear">
						<li class="col3">
							<em>出生日期&nbsp;</em>
							<input type="text" id="TBirthBgn" name="birthBgn" class="easyui-datebox" style="width:200px" editable="false" />
						</li>
						<li class="col3">
							<em>门诊/住院号&nbsp;</em>
							<input type="text" name="CMenzhenNo" />
						</li>
					</ol>
				</ol>

				<div class="ui-screening">
					<div class="ui-screening-more" onclick="screeningMore(this)">
						<span>展开</span>
						<i class="iconfont icon-jiantou-bottom"></i>
					</div>
				</div>
				<div class="ui-btn">
					<a href="javascript:void(0)" class="queryBtn_">
						<em class="iconfont icon-fangdajing"></em>
						<i>查询</i>
					</a>
					<a href="javascript:void(0)" onclick="clearForm()">
						<em class="iconfont icon-delete"></em>
						<i>清空</i>
					</a>
				</div>
			</div>
		</form>
		<table id="archMgr" class="easyui-datagrid" style="width:100%; height:100%;" rownumbers="true" data-options="fit:true,toolbar:'#tb',footer:'#ft',pagination:true,pagination:true,pageSize:20,singleSelect:true">
			<thead>
			<tr>
				<th field="CChildId" data-options="hidden:true">孩子ID</th>
				<th field="CUserId" data-options="hidden:true">父母ID</th>
				<th field="CChildNme" width="15%">姓名</th>
				<th field="CChildSex" width="10%" data-options="formatter:formatSex1">性别</th>
				<th field="TBirthday" width="20%">出生日期</th>
				<th field="CPhone" width="15%">手机号码</th>
				<th field="CIdNo" width="20%">门诊/住院号</th>
				<th field="TCrtTm" width="20%">建档时间</th>
			</tr>
		    </thead>
		</table>
		<div id="ft" style="padding:5px 8px 10px 8px;height:auto">

		</div>
	</div>
	
	<script type="text/javascript">
		$(document).ready(function(){
			$("#CChildSex").combobox("clear");

			//页面初始化时获取数据
			//初始化时就给queryBtn绑定了页面中的query方法
			utils.initDataGrid();


			utils.initHelpWindow(true);
			query();
			utils.closeLoading();
		});


		//点击显示隐藏筛选条件
		//***************************************************************************************
		//*****注意：由于form表单的结构不一样，量表的查询和（听力筛查、体格检查）的该方法不一样123************
		//***************************************************************************************
		function screeningMore(obj){
			var maxHeight=122;//展开的高度
			var minHeight=38;//收缩的高度
			var delay = 300;
			if($("#screeningMore").css("height")==(minHeight+"px")){
				$("#screeningMore").animate({"height":maxHeight+"px"},delay);
				$(obj).find("span").text("收起");
				$(obj).find("i").css({"transform":"rotate(180deg)","-webkit-transform":"rotate(180deg)"});
				$("#state").show(delay);

				$(".datagrid-view").animate({"height":$(".datagrid-view").height()-maxHeight},delay);
				$(".datagrid-body").animate({"height":$(".datagrid-body").height()-maxHeight},delay);

			}else{
				$("#screeningMore").animate({"height":minHeight+"px"},delay);
				$(obj).find("span").text("展开");
				$(obj).find("i").css({"transform":"rotate(360deg)","-webkit-transform":"rotate(360deg)"});
				$("#state").hide(delay);

				$(".datagrid-view").animate({"height":$(".datagrid-view").height()+maxHeight},delay);
				$(".datagrid-body").animate({"height":$(".datagrid-body").height()+maxHeight},delay);
			}
		}

		//清空查询条件
		function clearForm(){
			$("#tb").form("clear");
		}

		function query(){
			//判断出生日期结束时间不能在开始时间之前
			var TBirthBgn = new Date($("#TBirthBgn").datebox("getValue"));//转换为开始时间
			utils.ajax({
				control:"arch/list",
				method:"query",
				forms : [ "tb" ],
				validate : true,
				sucFun : function(mrk, bd, cd) {
					if (mrk) {
						// utils.showMsg("查询成功");
					} else {
						utils.showMsg("查询失败");
					}
				}
			});
		}

		function formatSex1(value,row,index){
			if("F"==value)
				return "女";
			else
				return "男";
		}
	</script>
	
</body>
</html>
