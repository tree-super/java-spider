<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1"/>
    <title>持续注意力测试系统 | 测评报告</title>
    <th:block th:replace="common/res::res"></th:block>
    <link rel="stylesheet" type="text/css" th:href="@{/css/report.css}">
    <style type="text/css">
        .questionnaire{width: 595px;margin: 0 auto;}
        .questionnaire .questionnaire-left .questionnaire-tit>h4{font-size: 22px;line-height: initial;padding: 10px 0;display: block;}
        .questionnaire .questionnaire-left .children-info{border-bottom: none;padding-bottom: 15px;margin: 0;}
        .questionnaire .questionnaire-left .subject .ui-notes{clear: both;border:none;margin: 40px 0}
        .questionnaire .questionnaire-left .subject .ui-gauge ol li{width: initial;line-height: initial;float: right;}
        .questionnaire .questionnaire-left .subject .ui-gauge ol li em{font-size: 20px;line-height: initial;}
        .questionnaire .questionnaire-left .subject .ui-gauge ol li input {width: 80px;font-size: 20px;height: 28px;line-height: 28px;}
        .chart-box {
            margin: 0 60px;
            position: relative;
        }

        .chart-box .chart {
            width: 100%;
            height: 310px;
            float: left;
        }

        .chart-box .chart-line{
            height: 1px;
            background: #000;
            position: absolute;
            top: 0;
            left: 44px;
            right: 43px;
        }
        .chart-box .chart-mask{
            width: 15px;
            height: 15px;
            background: #fff;
            position: absolute;
            top: 0;
            left: 22px;
        }

        .chart-box .chart canvas {
            width: 100% !important
        }
        @media print {
            .chart-box .chart-line {
                background-color: #000 !important;
                -webkit-print-color-adjust: exact;
            }
        }
    </style>
    <script type="text/javascript" th:src="@{/plugin/echarts/echarts.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/lb/report.js}"></script>
</head>

<body>
<div class="questionnaire ui-report">
    <div class="questionnaire-left">
        <div class="questionnaire-tit">
            <h5 id="hospitalNme">医院儿科</h5>
            <h4 id="lbNme">视觉持续性注意测试报告</h4>
        </div>
        <div class="children-info">
            <form id="basic">
                <ul class="clear">
                    <input type="hidden" name="CLbId" value="1804"/>
                    <input type="hidden" name="CPkId"/>
                    <input type="hidden" name="CParentId"/>
                    <input type="hidden" name="CChildId"/>
                    <input type="hidden" name="CUserId"/>
                    <input type="hidden" name="TTestTm">
                    <input type="hidden" name="CFormId" value="f1"/><!-- 默认显示第一个form -->
                    <li class="col3">
                        <em>姓&emsp;&emsp;名</em>
                        <div class="children-info-input"><input type="text" name="CChildNme"
                                                                class="easyui-validatebox"/></div>
                    </li>
                    <li class="col3">
                        <em>性&emsp;&emsp;&emsp;&nbsp;别</em>
                        <div class="children-info-input">
                            <!-- jeasyui的api使用必须使用id CChildSex不能去掉 -->
                            <select class="easyui-combobox" id="CChildSex" name="CChildSex" data-options="required:true">
                                <option value="M">男</option>
                                <option value="F">女</option>
                            </select>
                        </div>
                    </li>
                    <li class="col3">
                        <em>年&emsp;&emsp;龄</em>
                        <div class="children-info-input">
                            <input type="text" value="" id="CAge" name="CAge"/>
                        </div>
                    </li>
                    <li class="col3">
                        <em>测试时间</em>
                        <div class="children-info-input"><input type="text" name="TTestTm"/></div>
                    </li>
                    <li class="col3">
                        <em>门诊/住院号</em>
                        <div class="children-info-input"><input type="text" name="CMenzhenNo"/></div>
                    </li>
                    <li class="col3">
                        <em>申请医生</em>
                        <div class="children-info-input"><input type="text" name="CDoctor"/></div>
                    </li>
                </ul>
            </form>
        </div>
        <!--表格模式-->
        <div class="subject">
            <form id="f1">
                <div class="chart-box clear">
                    <div class="chart" id="chart1"></div>
                    <img id="chart1Img" class="chart" style="display:none"/>
                    <div class="chart" id="chart2"></div>
                    <img id="chart2Img" class="chart" style="display:none"/>
                    <div class="chart-line" style=" top: 60px;"></div>
                    <div class="chart-line" style="top: 370px;"></div>
                    <div class="chart-mask" style=" top: 238px;"></div>
                    <div class="chart-mask" style=" top: 548px;"></div>
                </div>
                <ul class="ui-notes" style="border: none;">
                    <li>受试者在《持续性注意测验》的结果显示：错误数：<span id=cwcount></span>，T分<span id=cwT></span>，百分位：<span name=cwBfw></span>，说明与同龄儿童相比，
                        其错误数比<span name=cwBfw></span>%儿童多；比<span id=100cwBfw></span>%儿童少；漏报数：<span id=lbcount></span>，T分：<span id=lbT></span>，百分位：<span name=lbBfw></span>，说明与同龄儿童相比，
                        其漏报数比<span name=lbBfw></span>%儿童多；比<span id=100lbBfw></span>%儿童少，反应时间：<span id=reactionTime></span>毫秒，T分：<span id=rtT></span>，百分位：<span name=rtBfw></span>，说明与同龄儿童相比，
                        其反应时间比<span name=rtBfw></span>%儿童慢；比<span id=100rtBfw></span>%儿童快；本测验结果反映该儿童<span id=result1></span>注意力<span id=result2></span>障碍。
                    </li>
                </ul>
                <ul class="ui-notes">
                    <li>医生意见：</li>
                </ul>
                <div class="ui-gauge">
                    <ol class="clear">
                        <li>
                            <em>报告者签章</em>
                            <input type="text" name="CExecutor">
                        </li>
                    </ol>
                </div>

            </form>
        </div>
        <!--查看报告打印按钮-->
        <div class="ui-btn noprint">
            <a href="javascript:void(0)"
               onClick="$('#memo0101').css('color','#000');printReport();$('#memo0101').css('color','red');">
                <em class="iconfont icon-dayin"></em>
                <i>打印报告</i>
            </a>
<!--            <a href="javascript:void(0)" onClick="exportPDF();">-->
<!--                <em class="iconfont icon-pdf"></em>-->
<!--                <i>导出PDF</i>-->
<!--            </a>-->
        </div>
    </div>
</div>
</body>
<script type="text/javascript">
    var pkid = '[[${pkid}]]';
    $(document).ready(function () {
        initReport();
        initLbpcReport(pkid);
        utils.closeLoading();
    });

    var cwcount = 0;
    var lbcount = 0;

    function showPage(mrk, bd, cd) {
        var year = cd["formData"]["NYear"];
        var month = cd["formData"]["NMonth"];
        var day = cd["formData"]["NDay"];
        var months = year * 12 + month;
        for (var i = 1; i <= 8; i++) {
            $("span[name='CAns" + i + "']").html(cd["formData"]["CAns" + i]);
        }
        var CExt1Str = cd["formData"]["CExt1"];
        var CExt1 = $.parseJSON(CExt1Str);
        var example = [2, 4, 6, 8, 10, 12, 14, 16, 18, 20];
        var cwy = [0];
        var lby = [0];
        var x = [0];
        for (var i = 0; i < CExt1.length; i++) {
            cwcount = cwcount + CExt1[i].cw;
            lbcount = lbcount + CExt1[i].lb;
            var cw = CExt1[i].cw;
            var lb = CExt1[i].lb;
            //大于20的值显示为20
            if(cw>20){
                cw=20;
            }
            if(lb>20){
                lb=20;
            }
            cwy.push(cw);
            lby.push(lb);
            x.push(example[i]);

        }
        chart1(x, cwy);
        chart2(x, lby);
        $("#lbcount").html(lbcount);
        $("#cwcount").html(cwcount);
        $("#cwT").html(cd["formData"]["CAns4"]);
        $("span[name='cwBfw']").html(cd["formData"]["CAns1"]);
        $("#100cwBfw").html((100-parseFloat(cd["formData"]["CAns1"])).toFixed(2));
        $("#lbT").html(cd["formData"]["CAns5"]);
        $("span[name='lbBfw']").html(cd["formData"]["CAns2"]);
        $("#100lbBfw").html((100-parseFloat(cd["formData"]["CAns2"])).toFixed(2));
        $("#reactionTime").html(cd["formData"]["CAns11"]);
        $("#rtT").html(cd["formData"]["CAns6"]);
        $("span[name='rtBfw']").html(cd["formData"]["CAns3"]);
        $("#100rtBfw").html((100-parseFloat(cd["formData"]["CAns3"])).toFixed(2));
        $("#result1").html(cd["formData"]["CAns7"]);
        $("#result2").html(cd["formData"]["CAns8"]);

    }

    //图一
    function chart1(x, cwy) {
        var chart1 = echarts.init(document.getElementById('chart1'));
        var option = {
            color: ["#f71f1f", "#520f36", "#146868", "#2d8b21", "#9eaf2d", "#33c999", "#33c999", "#33c999"],
            title: {
                text: '错误数：'+cwcount,
                left:40,
                textStyle: {
                    color: '#333',
                    fontFamily: 'Microsoft YaHei',
                    fontSize: '14'
                },
                subtextStyle: {
                    fontFamily: 'Microsoft YaHei',
                    color: '#666',
                },
            },
            xAxis: [
                {
                    name: ' 时间\n（分）',
                    type: 'category',
                    boundaryGap: false,
                    splitLine: {
                        show: false
                    },
                    axisLabel: {
                        rotate: 30
                    },
                    data: x
                },
                {
                    type: 'category',
                    boundaryGap: true,
                    borderRadius: 5,
                    splitLine: {
                        show: false
                    },
                    axisLabel: {
                        rotate: 30
                    }
                }
            ],
            yAxis: [
                {
                    name: '次数',
                    type: 'value',
                    minInterval: 1,
                    splitLine: {
                        show: false
                    },
                    max   : 20,
                    min : 0,
                    minInterval : 2,
                    maxInterval :2
                },
                {
                    type: 'value',
                    splitLine: {
                        show: false
                    }
                }
            ],
            series: [{
                data: cwy,
                type: 'line',
                itemStyle: {normal: {label: {show: true}}},
                symbol:'roundRect',
                symbolSize: 8
            }]
        };
        chart1.setOption(option);
        setTimeout(function () {
            var dataUrl =echarts.getInstanceByDom(document.getElementById("chart1")).getDataURL({type:'jpg',pixelRatio: 2});
            $("#chart1").hide();
            $("#chart1Img").attr("src",dataUrl).show();
        }, 1500);
    }

    //图二
    function chart2(x, lby) {
        var chart2 = echarts.init(document.getElementById('chart2'));
        var option = {
            color: ["#f71f1f", "#520f36", "#146868", "#2d8b21", "#9eaf2d", "#33c999", "#33c999", "#33c999"],
            title: {
                text: '漏报数：'+lbcount,
                left:40,
                textStyle: {
                    color: '#333',
                    fontFamily: 'Microsoft YaHei',
                    fontSize: '14'
                },
                subtextStyle: {
                    fontFamily: 'Microsoft YaHei',
                    color: '#666',
                }
            },
            xAxis: [{
                name: ' 时间\n（分）',
                type: 'category',
                boundaryGap: false,
                splitLine: {
                    show: false
                },
                axisLabel: {
                    rotate: 30
                },
                data: x
            },
                {
                    type: 'category',
                    boundaryGap: false,
                    splitLine: {
                        show: false
                    },
                    axisLabel: {
                        rotate: 30
                    }
                }
            ],
            yAxis: [{
                name: '次数',
                type: 'value',
                minInterval: 1,
                splitLine: {
                    show: false
                },
                max   : 20,
                min : 0,
                minInterval : 2,
                maxInterval :2
            },{
                splitLine: {
                    show: false
                },
            }],
            series: [{
                data: lby,
                type: 'line',
                itemStyle: {normal: {label: {show: true}}},
                symbol:'roundRect',
                symbolSize: 8
            }]
        };
        chart2.setOption(option);
        setTimeout(function () {
            var dataUrl
                =echarts.getInstanceByDom(document.getElementById("chart2")).getDataURL({type:'jpg',pixelRatio: 2});
            $("#chart2").hide();
            $("#chart2Img").attr("src",dataUrl).show();
        }, 1500);
    }
</script>
</html>

